Browser base64 Session Description<br />
<textarea id="localSessionDescription" readonly="true"></textarea> <br />

Golang base64 Session Description<br />
<textarea id="remoteSessionDescription"></textarea> <br />
<button onclick="window.startSession()">Start Session</button><br />

<br />

Video<br />
<div id="remoteVideos"></div>
<br />

Logs<br />
<div id="logs"></div>
<script>
  /* eslint-env browser */

  let pc = new RTCPeerConnection({
    iceServers: [
      {
        urls: "stun:stun.l.google.com:19302"
      }
    ]
  });
  var log = msg => {
    document.getElementById("logs").innerHTML += msg + "<br>";
  };

  navigator.mediaDevices
    .getUserMedia({ audio: true })
    .then(stream => {
      pc.addStream(stream);
      pc.createOffer()
        .then(description => pc.setLocalDescription(description))
        .catch(log);
    })
    .catch(log);

  pc.oniceconnectionstatechange = e => log(pc.iceConnectionState);
  pc.onicecandidate = async event => {
    if (event.candidate === null) {
      /*     document.getElementById('localSessionDescription').value = btoa(JSON.stringify(pc.localDescription)) */

      document.getElementById("localSessionDescription").value = JSON.stringify(
        pc.localDescription
      );

      try {
        console.log("sending offer request...");
        const res = await fetch("http://localhost:8080/offer", {
          method: "POST",
          body: JSON.stringify(pc.localDescription)
        });
        const json = await res.json();
        console.log("offer request sent", json);

        pc.setRemoteDescription(new RTCSessionDescription(json));
      } catch (error) {
        console.error(error);
      }
    }
  };
  pc.ontrack = function(event) {
    var el = document.createElement(event.track.kind);
    el.srcObject = event.streams[0];
    el.autoplay = true;
    el.controls = true;

    document.getElementById("remoteVideos").appendChild(el);
  };

  window.startSession = () => {
    let sd = document.getElementById("remoteSessionDescription").value;
    if (sd === "") {
      return alert("Session Description must not be empty");
    }

    try {
      pc.setRemoteDescription(new RTCSessionDescription(JSON.parse(atob(sd))));
    } catch (e) {
      alert(e);
    }
  };
</script>
